<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Benchmark with Matlab and Astra · RadonKA.jl</title><meta name="title" content="Benchmark with Matlab and Astra · RadonKA.jl"/><meta property="og:title" content="Benchmark with Matlab and Astra · RadonKA.jl"/><meta property="twitter:title" content="Benchmark with Matlab and Astra · RadonKA.jl"/><meta name="description" content="Documentation for RadonKA.jl."/><meta property="og:description" content="Documentation for RadonKA.jl."/><meta property="twitter:description" content="Documentation for RadonKA.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="RadonKA.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">RadonKA.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">RadonKA.jl</a></li><li><a class="tocitem" href="../mathematical/">Mathematical Background</a></li><li><a class="tocitem" href="../tutorial/">Simple Tutorial</a></li><li><a class="tocitem" href="../geometries/">Specifying different geometries and absorption</a></li><li class="is-active"><a class="tocitem" href>Benchmark with Matlab and Astra</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#Results"><span>Results</span></a></li><li><a class="tocitem" href="#RadonKA.jl"><span>RadonKA.jl</span></a></li><li><a class="tocitem" href="#torch-radon"><span>torch-radon</span></a></li><li><a class="tocitem" href="#Matlab-(R2023a)"><span>Matlab (R2023a)</span></a></li><li><a class="tocitem" href="#Astra"><span>Astra</span></a></li></ul></li><li><a class="tocitem" href="../functions/">Function Docstrings</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Benchmark with Matlab and Astra</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Benchmark with Matlab and Astra</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/roflmaostc/RadonKA.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/roflmaostc/RadonKA.jl/blob/main/docs/src/benchmark.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Benchmark-and-Comparison-with-Matlab,-Astra,-torch-radon"><a class="docs-heading-anchor" href="#Benchmark-and-Comparison-with-Matlab,-Astra,-torch-radon">Benchmark and Comparison with Matlab, Astra, torch-radon</a><a id="Benchmark-and-Comparison-with-Matlab,-Astra,-torch-radon-1"></a><a class="docs-heading-anchor-permalink" href="#Benchmark-and-Comparison-with-Matlab,-Astra,-torch-radon" title="Permalink"></a></h1><p>Tested on a AMD Ryzen 9 5900X 12-Core Processor with 24 Threads and a NVIDIA GeForce RTX 3060 with Julia 1.10.0 on Ubuntu 22.04.</p><h1 id="Results"><a class="docs-heading-anchor" href="#Results">Results</a><a id="Results-1"></a><a class="docs-heading-anchor-permalink" href="#Results" title="Permalink"></a></h1><table><tr><th style="text-align: right"></th><th style="text-align: right">RadonKA.jl CPU</th><th style="text-align: right">RadonKA.jl CUDA</th><th style="text-align: right">Matlab CPU</th><th style="text-align: right">Astra CPU</th><th style="text-align: right">Astra CUDA</th><th style="text-align: right">torch-radon CUDA</th></tr><tr><td style="text-align: right">2D sample - Radon</td><td style="text-align: right">1.1s</td><td style="text-align: right">0.07s</td><td style="text-align: right">0.39s</td><td style="text-align: right">7.0s</td><td style="text-align: right">0.025s</td><td style="text-align: right">0.011s</td></tr><tr><td style="text-align: right">2D sample - Backprojection</td><td style="text-align: right">1.4s</td><td style="text-align: right">0.50s</td><td style="text-align: right">0.37s</td><td style="text-align: right">6.4s</td><td style="text-align: right">N/A</td><td style="text-align: right">0.008s</td></tr><tr><td style="text-align: right">3D sample - Radon</td><td style="text-align: right">7.4s</td><td style="text-align: right">0.28s</td><td style="text-align: right">9.01s</td><td style="text-align: right">N/A</td><td style="text-align: right">1.12s</td><td style="text-align: right">0.062s</td></tr><tr><td style="text-align: right">3D sample - Backprojection</td><td style="text-align: right">7.9s</td><td style="text-align: right">0.53s</td><td style="text-align: right">3.24s</td><td style="text-align: right">N/A</td><td style="text-align: right">N/A</td><td style="text-align: right">0.063s</td></tr></table><h2 id="RadonKA.jl"><a class="docs-heading-anchor" href="#RadonKA.jl">RadonKA.jl</a><a id="RadonKA.jl-1"></a><a class="docs-heading-anchor-permalink" href="#RadonKA.jl" title="Permalink"></a></h2><pre><code class="language-julia hljs"> using IndexFunArrays, ImageShow, Plots, ImageIO, PlutoUI, PlutoTest, TestImages
 using RadonKA
 using CUDA, CUDA.CUDAKernels
 using BenchmarkTools
 
 sample_2D = Float32.(testimage(&quot;resolution_test_1920&quot;));
 sample_2D_c = CuArray(sample_2D);
 simshow(sample_2D)
 
 angles = range(0, 2π, 500);
 angles_c = CuArray(angles);
 
 # run those cells multiple times
 sinogram = radon(sample_2D, angles);
 @btime sinogram = radon($sample_2D, $angles);
 simshow(sinogram)
 @btime sample_backproject = backproject($sinogram, $angles);
 
 @btime CUDA.@sync sinogram_c = radon($sample_2D_c, $angles_c);
 sinogram_c = radon(sample_2D_c, angles_c);
 @btime CUDA.@sync sample_backproject_c = backproject($sinogram_c, $angles_c);
 
 
 sample_3D = randn(Float32, (512, 512, 100));
 sample_3D_c = CuArray(sample_3D)
 
 sinogram_3D = radon(sample_3D, angles);
 @btime radon($sample_3D, $angles)
 @btime backproject($sinogram_3D, $angles)
 
 sinogram_3D_c = radon(sample_3D_c, angles_c)
 @btime CUDA.@sync radon($sample_3D_c, $angles_c)
 @btime CUDA.@sync backproject($sinogram_3D_c, $angles_c)</code></pre><p><img src="../assets/radonka_sinogram.png" alt/> <img src="../assets/radonka_backproject.png" alt/></p><h2 id="torch-radon"><a class="docs-heading-anchor" href="#torch-radon">torch-radon</a><a id="torch-radon-1"></a><a class="docs-heading-anchor-permalink" href="#torch-radon" title="Permalink"></a></h2><pre><code class="language-python hljs">import torch
import torch_radon


volume = torch_radon.volumes.Volume2D()
angles = torch.tensor(np.linspace(0, 2*np.pi, 500), dtype=torch.float32, device=&quot;cuda&quot;)
sample = torch.rand(1,1920, 1920, device=&quot;cuda&quot;)
radon = torch_radon.ParallelBeam(volume=volume, angles=angles, det_spacing=1.0, det_count=1920)


%%timeit
radon.forward(sample)
torch.cuda.synchronize()

sinogram = radon.forward(sample)

%%timeit
radon.backward(sinogram)
torch.cuda.synchronize()



angles = torch.tensor(np.linspace(0, 2*np.pi, 500), dtype=torch.float32, device=&quot;cuda&quot;)
sample = torch.rand(100, 512, 512, device=&quot;cuda&quot;)
radon = torch_radon.ParallelBeam(volume=volume, angles=angles, det_spacing=1.0, det_count=512)


%%timeit
radon.forward(sample)
torch.cuda.synchronize()

sinogram = radon.forward(sample)

%%timeit
radon.backward(sinogram)
torch.cuda.synchronize()</code></pre><h2 id="Matlab-(R2023a)"><a class="docs-heading-anchor" href="#Matlab-(R2023a)">Matlab (R2023a)</a><a id="Matlab-(R2023a)-1"></a><a class="docs-heading-anchor-permalink" href="#Matlab-(R2023a)" title="Permalink"></a></h2><pre><code class="language-matlab hljs">arr = single(imread(&quot;/tmp/sample.jpg&quot;)); 
%arr = rand(1920, 1920, &quot;single&quot;);
theta = linspace(0, 360, 500);

tic;
R = radon(arr, theta);
toc;
R = R / max(R(:));
imwrite(R, &quot;/tmp/matlab_sinogram.png&quot;);

tic; 
iR = backproject(R, theta, &quot;linear&quot;, &quot;none&quot;);
toc;
iR = iR / max(iR(:));
imwrite(iR, &quot;/tmp/matlab_backproject.png&quot;);



x = (rand(100, 512, 512, &#39;single&#39;));

theta = linspace(0, 360, 500);
y = (zeros(size(x, 1), size(radon(squeeze(x(1, :, :)), theta), 1), size(radon(squeeze(x(1, :, :)), theta), 2), &#39;single&#39;));
ix = zeros(100, 514, 514, &quot;single&quot;);

tic;
for i = 1:size(x, 1)
    y(i, :, :) = radon(squeeze(x(i, :, :)), theta);
end
toc;


tic;
for i = 1:size(y, 1)
    ix(i, :, :) = backproject(squeeze(y(i, :, :)), theta);
end
toc;</code></pre><p><img src="../assets/matlab_sinogram.png" alt/> <img src="../assets/matlab_backproject.png" alt/></p><h2 id="Astra"><a class="docs-heading-anchor" href="#Astra">Astra</a><a id="Astra-1"></a><a class="docs-heading-anchor-permalink" href="#Astra" title="Permalink"></a></h2><p>Some of the benchmarks did not run properly or were providing non-sense. Astra&#39;s docs are unfortunately slightly confusing...</p><pre><code class="language-python hljs">import numpy as np
import matplotlib.pyplot as plt
import imageio.v3 as iio
import astra

im = np.array(iio.imread(&#39;/tmp/sample.png&#39;), dtype=np.float32)

plt.imshow(im)


vol_geom = astra.create_vol_geom(1920, 1920)
angles =  np.linspace(0,2 * np.pi,500)

proj_geom = astra.create_proj_geom(&#39;parallel&#39;, 1.0, 1920, angles)
proj_id = astra.create_projector(&#39;line&#39;, proj_geom,vol_geom)


%%time
sinogram_id, sinogram = astra.create_sino(im, proj_id)
np.copy(sinogram);

plt.imshow(sinogram)

proj_geom = astra.create_proj_geom(&#39;parallel&#39;, 1.0, 1920, angles)
proj_id = astra.create_projector(&#39;cuda&#39;, proj_geom,vol_geom)

%%time
sinogram_id, sinogram = astra.create_sino(im, proj_id)
np.copy(sinogram);

rec_id = astra.data2d.create(&quot;-vol&quot;, vol_geom)
cfg = astra.astra_dict(&#39;BP&#39;)
cfg[&quot;ReconstructionDataId&quot;] = rec_id
cfg[&quot;ProjectionDataId&quot;] = sinogram_id
cfg[&quot;ProjectorId&quot;] = proj_id
# Create the algorithm object from the configuration structure
alg_id = astra.algorithm.create(cfg)
# Run back-projection and get the reconstruction

%%time
astra.algorithm.run(alg_id)
f_rec = astra.data2d.get(rec_id)
#np.copy(f_rec)


im_3D = np.random.rand(100, 512, 512)

vol_geom = astra.create_vol_geom(512, 512, 100)

proj_geom = astra.create_proj_geom(&#39;parallel3d&#39;, 1.0, 1.0, 512, 512, angles)
#proj_id = astra.create_projector(&#39;line&#39;, proj_geom,vol_geom)

%%time
proj_id, proj_data = astra.create_sino3d_gpu(im_3D, proj_geom, vol_geom)
np.copy(proj_data)


rec_id = astra.data3d.create(&#39;-vol&#39;, vol_geom)

# Set up the parameters for a reconstruction algorithm using the CUDA
cfg = astra.astra_dict(&#39;BP3D_CUDA&#39;)
cfg[&#39;ReconstructionDataId&#39;] = rec_id
cfg[&#39;ProjectionDataId&#39;] = proj_id


# Create the algorithm object from the configuration structure
alg_id = astra.algorithm.create(cfg)

%time
astra.algorithm.run(alg_id, 1)
rec = astra.data3d.get(rec_id)
np.copy(rec)</code></pre><p><img src="../assets/astra_sinogram.png" alt/> <img src="../assets/astra_backproject.png" alt/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../geometries/">« Specifying different geometries and absorption</a><a class="docs-footer-nextpage" href="../functions/">Function Docstrings »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Tuesday 30 April 2024 19:09">Tuesday 30 April 2024</span>. Using Julia version 1.10.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
